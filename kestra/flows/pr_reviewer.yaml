id: pr_reviewer
namespace: hackathon

inputs:
  - id: payload
    type: JSON
    description: "The raw JSON data from GitHub"

triggers:
  - id: github_webhook
    type: io.kestra.core.models.triggers.types.Webhook
    key: hackathon_secret

tasks:
  - id: run_reviewer
    type: io.kestra.core.tasks.scripts.Bash
    # SAFETY FIX: Pass the massive JSON as an Environment Variable
    # This prevents shell quoting issues.
    env:
      GITHUB_PAYLOAD: "{{ trigger.body | toJson }}"
    commands:
      - |
        echo "--- STARTING REVIEWER SCRIPT ---"
        # The script reads the ENV variable instead of CLI args
        python3 /app/scripts/reviewer.py
